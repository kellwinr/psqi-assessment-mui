<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSQI Calculator | DEMO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Glassmorphism Tokens */
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --blur-strength: 12px;
            
            /* Colors */
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --accent: #06b6d4;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            
            /* Spacing */
            --radius-xl: 24px;
            --radius-l: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: var(--text-main);
            /* Animated Mesh Gradient Background */
            background: linear-gradient(45deg, #e0f2fe, #f0f9ff, #eef2ff);
            background-size: 400% 400%;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            position: relative;
        }

        /* --- Ambient Background Animations --- */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            animation: float 10s infinite ease-in-out;
        }
        .orb-1 {
            width: 400px; height: 400px;
            background: rgba(37, 99, 235, 0.2);
            top: -50px; left: -100px;
        }
        .orb-2 {
            width: 300px; height: 300px;
            background: rgba(6, 182, 212, 0.2);
            bottom: 10%; right: -50px;
            animation-delay: -2s;
        }
        .orb-3 {
            width: 200px; height: 200px;
            background: rgba(139, 92, 246, 0.15);
            top: 40%; left: 60%;
            animation-delay: -5s;
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            50% { transform: translate(0, 20px); }
            100% { transform: translate(0, 0); }
        }

        .app-container {
            width: 100%;
            max-width: 750px;
            padding: 40px 20px;
            z-index: 1;
        }

        /* --- Header --- */
        header {
            text-align: center;
            margin-bottom: 50px;
            animation: slideDown 0.8s ease-out;
        }
        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            letter-spacing: -1px;
            text-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-top: 10px;
            font-weight: 400;
        }

        /* --- Glass Cards --- */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--glass-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px 0 rgba(31, 38, 135, 0.2);
            background: rgba(255, 255, 255, 0.75);
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .section-icon {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
        }

        /* --- Inputs --- */
        .input-group { margin-bottom: 24px; position: relative; }
        
        label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            margin-left: 4px;
        }

        .input-wrapper {
            position: relative;
        }

        input, select {
            width: 100%;
            border: 2px solid transparent;
            background: rgba(255,255,255,0.5);
            padding: 16px 20px;
            font-size: 1rem;
            color: var(--text-main);
            border-radius: var(--radius-l);
            box-sizing: border-box;
            outline: none;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }

        input:hover, select:hover {
            background: rgba(255,255,255,0.8);
        }

        input:focus, select:focus {
            background: #fff;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .helper {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 6px;
            margin-left: 4px;
        }

        /* --- Buttons --- */
        .btn-group {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 16px;
            margin-top: 20px;
        }

        .calculate-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            padding: 20px;
            border-radius: 100px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 15px 30px rgba(37, 99, 235, 0.4);
        }
        
        .calculate-btn:active { transform: scale(0.98); }

        .reset-btn {
            background: rgba(255,255,255,0.5);
            color: var(--text-muted);
            border: 1px solid transparent;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .reset-btn:hover { 
            background: white; 
            color: var(--danger);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        /* --- Results Section --- */
        #results-section {
            display: none;
            margin-top: 40px;
        }

        .global-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: var(--radius-xl);
            text-align: center;
            border: 1px solid white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            animation: popUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Animated glow behind global score */
        .global-card::before {
            content: '';
            position: absolute;
            width: 150px;
            height: 150px;
            background: var(--primary);
            filter: blur(60px);
            opacity: 0.2;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .global-label {
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        .global-value {
            font-size: 5rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            line-height: 1;
            margin: 15px 0;
            position: relative;
            z-index: 2;
            background: linear-gradient(180deg, var(--text-main), var(--text-muted));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .interpretation {
            display: inline-block;
            padding: 8px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .status-good { background: #d1fae5; color: #065f46; border: 1px solid #10b981; }
        .status-bad { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-top: 30px;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255,255,255,0.6);
            padding: 15px 10px;
            border-radius: var(--radius-l);
            text-align: center;
            opacity: 0;
            animation: fadeSlideUp 0.5s ease forwards;
        }

        .result-card span {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .result-card strong {
            font-size: 1.4rem;
            font-family: 'Poppins', sans-serif;
            color: var(--primary);
        }

        .math-box {
            background: rgba(0,0,0,0.03);
            border-left: 3px solid var(--text-muted);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* --- Animations --- */
        @keyframes slideDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popUp { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Responsive --- */
        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .btn-group { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .results-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media print {
            body { background: white; }
            .orb { display: none; }
            .card, .global-card { box-shadow: none; border: 1px solid #ddd; backdrop-filter: none; background: white; }
            .calculate-btn, .reset-btn { display: none; }
            #results-section { display: block !important; }
        }
    </style>
</head>
<body>

<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<div class="app-container">

    <header>
        <h1>PSQI Calculator</h1>
        <div class="subtitle">Pittsburgh Sleep Quality Index</div>
    </header>

    <form id="psqiForm">
        
        <div class="card">
            <div class="section-title"><div class="section-icon">1</div> Time & Duration</div>
            
            <div class="input-group">
                <label>Q1. Bed Time</label>
                <div class="input-wrapper">
                    <input type="time" id="bedTime" required>
                </div>
            </div>

            <div class="input-group">
                <label>Q3. Wake Up Time</label>
                <div class="input-wrapper">
                    <input type="time" id="wakeTime" required>
                </div>
            </div>

            <div class="input-group">
                <label>Q2. Minutes to Fall Asleep</label>
                <div class="input-wrapper">
                    <input type="number" id="latencyMins" placeholder="e.g. 20" min="0">
                </div>
                <div class="helper">Enter total minutes (latency)</div>
            </div>

            <div class="input-group">
                <label>Q4. Actual Hours Slept</label>
                <div class="input-wrapper">
                    <input type="number" id="sleepDur" step="0.5" placeholder="e.g. 6.5" min="0" max="24">
                </div>
                <div class="helper">Do not include time spent awake in bed</div>
            </div>
        </div>

        <div class="card">
            <div class="section-title"><div class="section-icon">2</div> Factors & Trouble</div>

            <div class="input-group">
                <label>Q5a. Trouble falling asleep within 30 min</label>
                <div class="input-wrapper">
                    <select id="q5a">
                        <option value="0">Not during past month (0)</option>
                        <option value="1">Less than once a week (1)</option>
                        <option value="2">Once or twice a week (2)</option>
                        <option value="3">3 or more times a week (3)</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>Q5b-j. Sum of Disturbance Scores</label>
                <div class="input-wrapper">
                    <input type="number" id="disturbSum" placeholder="0" min="0" max="27" value="0">
                </div>
                <div class="helper">Sum of items 5b through 5j (0-3 scale each)</div>
            </div>

            <div class="input-group">
                <label>Q6. Subjective Sleep Quality</label>
                <div class="input-wrapper">
                    <select id="q6">
                        <option value="0">Very Good (0)</option>
                        <option value="1">Fairly Good (1)</option>
                        <option value="2">Fairly Bad (2)</option>
                        <option value="3">Very Bad (3)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-title"><div class="section-icon">3</div> Meds & Dysfunction</div>

            <div class="input-group">
                <label>Q7. Use of Sleep Medication</label>
                <div class="input-wrapper">
                    <select id="q7">
                        <option value="0">None (0)</option>
                        <option value="1">< 1/week (1)</option>
                        <option value="2">1-2/week (2)</option>
                        <option value="3">3+/week (3)</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>Q8. Trouble Staying Awake</label>
                <div class="input-wrapper">
                    <select id="q8">
                        <option value="0">None (0)</option>
                        <option value="1">< 1/week (1)</option>
                        <option value="2">1-2/week (2)</option>
                        <option value="3">3+/week (3)</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>Q9. Problem with Enthusiasm</label>
                <div class="input-wrapper">
                    <select id="q9">
                        <option value="0">No problem (0)</option>
                        <option value="1">Slight problem (1)</option>
                        <option value="2">Somewhat of a problem (2)</option>
                        <option value="3">Big problem (3)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button type="button" class="calculate-btn" onclick="calculatePSQI()">
                Calculate Score
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
            <button type="button" class="reset-btn" onclick="resetForm()">
                Reset
            </button>
        </div>

    </form>

    <div id="results-section">
        
        <div class="global-card">
            <div class="global-label">Global PSQI Score</div>
            <div class="global-value" id="globalScore">0</div>
            <div class="interpretation" id="interpretation">Good Sleep Quality</div>
        </div>

        <h3 style="margin-top: 30px; font-family: 'Poppins', sans-serif; font-size: 1.1rem; color: var(--text-main);">Component Breakdown</h3>
        <div class="results-grid">
            <div class="result-card" style="animation-delay: 0.1s">
                <span>Quality</span>
                <strong id="c1">0</strong>
            </div>
            <div class="result-card" style="animation-delay: 0.15s">
                <span>Latency</span>
                <strong id="c2">0</strong>
            </div>
            <div class="result-card" style="animation-delay: 0.2s">
                <span>Duration</span>
                <strong id="c3">0</strong>
            </div>
            <div class="result-card" style="animation-delay: 0.25s">
                <span>Efficiency</span>
                <strong id="c4">0</strong>
            </div>
            <div class="result-card" style="animation-delay: 0.3s">
                <span>Disturb</span>
                <strong id="c5">0</strong>
            </div>
            <div class="result-card" style="animation-delay: 0.35s">
                <span>Meds</span>
                <strong id="c6">0</strong>
            </div>
            <div class="result-card" style="animation-delay: 0.4s">
                <span>Dysfunc</span>
                <strong id="c7">0</strong>
            </div>
        </div>

        <div style="margin-top: 40px; opacity: 0.9;">
            <strong style="font-size: 0.9rem; color: var(--text-main);">Calculation Log:</strong>
            <div class="math-box" id="debug-text">
                Waiting for input...
            </div>
        </div>

    </div>

</div>

<script>
    // The core logic remains robust and identical to ensure accuracy.
    function calculatePSQI() {
        const bedTimeStr = document.getElementById('bedTime').value;
        const wakeTimeStr = document.getElementById('wakeTime').value;
        const sleepDur = parseFloat(document.getElementById('sleepDur').value) || 0;
        
        if(!bedTimeStr || !wakeTimeStr) {
            alert("Please enter both Bed Time and Wake Time.");
            return;
        }
        if(sleepDur > 24) {
            alert("Error: Sleep Duration cannot exceed 24 hours.");
            return;
        }

        const latencyMins = parseFloat(document.getElementById('latencyMins').value) || 0;
        const q5a = parseInt(document.getElementById('q5a').value);
        const distSumRaw = parseInt(document.getElementById('disturbSum').value) || 0;
        const q6 = parseInt(document.getElementById('q6').value);
        const q7 = parseInt(document.getElementById('q7').value);
        const q8 = parseInt(document.getElementById('q8').value);
        const q9 = parseInt(document.getElementById('q9').value);

        function timeToDec(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours + (minutes / 60);
        }

        const bedDec = timeToDec(bedTimeStr);
        const wakeDec = timeToDec(wakeTimeStr);

        // Component 1
        let c1 = q6;

        // Component 2
        let q2Score = latencyMins > 60 ? 3 : latencyMins > 30 ? 2 : latencyMins > 15 ? 1 : 0;
        let latSum = q2Score + q5a;
        let c2 = latSum === 0 ? 0 : latSum <= 2 ? 1 : latSum <= 4 ? 2 : 3;

        // Component 3
        let c3 = sleepDur > 7 ? 0 : sleepDur >= 6 ? 1 : sleepDur >= 5 ? 2 : 3;

        // Component 4
        let hrsInBed = (wakeDec < bedDec) ? (wakeDec + 24) - bedDec : wakeDec - bedDec;
        if(hrsInBed < 0) hrsInBed += 24; 
        
        let efficiency = hrsInBed > 0 ? (sleepDur / hrsInBed) * 100 : 0;
        if(efficiency > 100) efficiency = 100;
        
        let c4 = efficiency > 85 ? 0 : efficiency >= 75 ? 1 : efficiency >= 65 ? 2 : 3;

        // Component 5
        let c5 = distSumRaw === 0 ? 0 : distSumRaw <= 9 ? 1 : distSumRaw <= 18 ? 2 : 3;

        // Component 6
        let c6 = q7;

        // Component 7
        let daySum = q8 + q9;
        let c7 = daySum === 0 ? 0 : daySum <= 2 ? 1 : daySum <= 4 ? 2 : 3;

        // Global
        let global = c1 + c2 + c3 + c4 + c5 + c6 + c7;

        // Update UI
        document.getElementById('c1').innerText = c1;
        document.getElementById('c2').innerText = c2;
        document.getElementById('c3').innerText = c3;
        document.getElementById('c4').innerText = c4;
        document.getElementById('c5').innerText = c5;
        document.getElementById('c6').innerText = c6;
        document.getElementById('c7').innerText = c7;
        
        const globalEl = document.getElementById('globalScore');
        globalEl.innerText = global;

        // Style & Interpretation
        const interpEl = document.getElementById('interpretation');
        
        interpEl.className = 'interpretation'; // Reset classes
        if(global >= 5) {
            interpEl.innerText = "Poor Sleep Quality (â‰¥5)";
            interpEl.classList.add('status-bad');
        } else {
            interpEl.innerText = "Good Sleep Quality (<5)";
            interpEl.classList.add('status-good');
        }

        // Debug Text
        document.getElementById('debug-text').innerHTML = 
            `Bed Time: ${bedTimeStr} | Wake Time: ${wakeTimeStr}<br>` +
            `Time in Bed: ${hrsInBed.toFixed(2)}h | Sleep Duration: ${sleepDur}h<br>` +
            `Efficiency: ${efficiency.toFixed(1)}%`;

        // Reveal with smooth scroll
        const resultsSection = document.getElementById('results-section');
        resultsSection.style.display = 'none';
        resultsSection.offsetHeight; // trigger reflow
        resultsSection.style.display = 'block';
        
        resultsSection.scrollIntoView({behavior: "smooth", block: "start"});
    }

    function resetForm() {
        document.getElementById('psqiForm').reset();
        document.getElementById('results-section').style.display = 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>

</body>
</html>
